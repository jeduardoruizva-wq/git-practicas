name: Stats
on: 
  push:
    branches: [main]

jobs: 
  build: 
    runs-on: ubuntu-latest
    steps: 
       - name: checkout repo
         uses: actions/checkout@v4
       - name: Set up Google Cloud
         uses: google-github-actions/setup-gcloud@v2
         with:
            project_id: ${{ secrets.GCP_PROJECT }}
            service_account_key: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_JSON }}
        # 2️⃣ Autenticar con Service Account
       - name: Authenticate to Google Cloud
         uses: google-github-actions/auth@v1
         with:
           credentials_json: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_JSON }}
        # 3️⃣ Configurar proyecto de GCP
       - name: Set GCP Project
         run: gcloud config set project ${{ secrets.GCP_PROJECT }}
        # 4️⃣ Desplegar proxy a Apigee
       - name: Deploy Apigee Proxy
         run: |
          gcloud apigee apis deploy \
          --organization=${{ secrets.APIGEE_ORG }} \
          --environment=${{ secrets.APIGEE_ENV }} \
          --api=${{ secrets.PROXY_NAME }} \
          --version=1 \
          --bundle=proxy.zip
